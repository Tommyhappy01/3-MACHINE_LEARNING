window.jQuery&&window.jQuery.fn.bem&&window.bemhtml&&(BEM.DOM.decl("nps",{getDefaultParams:function(){return{timeout:{show:1e4,hide:5e3}}},onSetMod:{js:{inited:function(){var t,s=this.params;this.cookie=BEM.blocks["i-cookie"].get(),this.isEqual=this.hasMod("equal","yes"),s.save&&this.cookie.yp(this.hasMod("cbir","yes")?"cnps":"nps",[s.rand,s.status].join(":"),s.expires),this.isClosed()||(this.findBlocks().bindEvents(),t=this.page.getMod("type"),this.hasMod("cbir","yes")?this.isCbirPages("b-page_type_"+t)&&this.show():"search"===t?this.show():this.location.on("b-page_type_search",this.show,this))}},hidden:{yes:function(){this.isClosed()||this.afterCurrentEvent(function(){this.popup.hide()})},"":function(){this.isClosed()||this.hasMod("search","yes")&&this._disable||this.hasMod("cbir","yes")&&this._disable||(this.hasMod("cbir","yes")&&this.isEqual&&this.searchPopup&&(this.searchPopup._disable=!0),this.hasMod("search","yes")&&this.isEqual&&this.cbirPopup&&(this.cbirPopup._disable=!0),this.afterCurrentEvent(function(){this.popup.show(this.popupAnchor)}))}},layout:{view:function(){this.hide()},"":function(){this.show()}}},findBlocks:function(){return this.popupAnchor=this.findBlockOutside("b-page").elem("content"),this.location=BEM.blocks.location.getInstance(),this.popup=this.findBlockOn("popup"),this.list=this.findBlockInside("radio-button"),this.button=this.findBlockInside("button"),this.question=this.elem("text"),this.page=this.findBlockOutside("b-page"),this.cbirPopup=this.page.findBlockInside({block:"nps",modName:"cbir",modVal:"yes"}),this.searchPopup=this.page.findBlockInside({block:"nps",modName:"search",modVal:"yes"}),this},bindEvents:function(){return this.button.on("click",this._onSendClick,this),this.popup.on("hide",this._onPopupHidden,this),this.list.on("clicked",this._onRadioChange,this),this.location.on("change",this._onPageChange,this),this},destruct:function(){this.button.un("click",this._onSendClick,this),this.popup.un("hide",this._onPopupHidden,this),this.list.un("clicked",this._onRadioChange,this),this.location.un("change",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(t,s){"b-page_type_search"===s.block?this.show():this.hide()},_onRadioChange:function(t,s){this.enableButton(),this.value=s},_onPopupHidden:function(){if(this.hasMod("hidden","yes"))return!1;this.hide();var t=this.getMod("type");return this.hasMod("minimized","yes")?(this.saveStatus("close"),this.hasMod("thanks","yes")||w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"close"].join("/"))):(this.minimizeNPS(),w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"small"].join("/")),this.show()),!1},_onSendClick:function(){var t=this.getMod("type");this.hasMod("minimized","yes")?(this.maximizeNPS(),this._isShown&&this.popup.repaint(),w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"normal"].join("/"))):(w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"result","p"+this.value].join("/")),this.showThanks())},hide:function(){return this.setMod("hidden","yes")},show:function(){if(!this.isClosed())return this._isShown?this.delMod("hidden"):this.startPopupTimer(),this},disableButton:function(){return this.button.delMod("focused").setMod("theme","normal").setMod("disabled","yes"),this},enableButton:function(){return this.button.setMod("theme","action").delMod("disabled"),this},initPopup:function(){var t=this.page.getMod("type");return this.hasMod("search","yes")&&"search"!==t?"":this.hasMod("cbir","yes")&&!this.isCbirPages("b-page_type_"+t)?"":(this._isShown=!0,this.hasMod("layout","view")||this.show().countShow(),void(this.hasMod("minimized","yes")?this.minimizeNPS():this.maximizeNPS()))},startPopupTimer:function(){this.location.un("b-page_type_search",this.show,this),setTimeout(this.changeThis(function(){this.initPopup(),this.popup.domElem.css({bottom:-this.domElem.height()+"px"}).animate({bottom:0})}),this.params.timeout.show)},countShow:function(){return this.params.save&&w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",this.getMod("type"),"show"].join("/")),this},minimizeNPS:function(){var t=this.params.i18n;return this.setMod("minimized","yes").setButtonText(t.answer).setQuestion(t.invite).enableButton().saveStatus("min")},maximizeNPS:function(){var t=this.params.i18n;return this.setMod("minimized","no").setButtonText(t.send).setQuestion(t.question).saveStatus("max"),this.value||this.disableButton(),this},showThanks:function(){var t=this.params;this.popup.hide().setMod("animate","yes"),this.setMod(this.elem("button"),"hidden","yes").setMod("minimized","yes").setMod("thanks","yes").saveStatus("close").setQuestion(t.i18n.thankyou).show(),setTimeout(this.changeThis(this.hide),t.timeout.hide)},setQuestion:function(t){return this.question.text(t),this},setButtonText:function(t){return this.button.elem("text").text(t),this},isClosed:function(){return"close"===this.params.status},saveStatus:function(t){return this.cookie.yp(this.hasMod("cbir","yes")?"cnps":"nps",[this.params.rand,t].join(":")),this.params.status=t,this}}),BEM.DOM.decl({block:"nps",modName:"cbir",modVal:"yes"},{isCbirPages:function(t){return-1!==["b-page_type_search-by-image","b-page_type_similar"].indexOf(t)},_onPageChange:function(t,s){this.isCbirPages(s.block)?this.show():this.hide()}}),BEM.DOM.decl({block:"radio-button",baseBlock:"radiobox"},{onSetMod:{disabled:{yes:function(){this.delMod("focused"),this.__base.apply(this,arguments)}}},onElemSetMod:{radio:{pressed:{yes:function(){this.delMod(this.elem("radio","pressed","yes"),"pressed")}}}},_onPointerPress:function(t){this._pressedRadio=t.data.domElem,this.isDisabled(this._pressedRadio)||(this.setMod(this._pressedRadio,"pressed","yes"),this.bindToDoc("pointerrelease",this._onPointerRelease))},_onPointerRelease:function(t){var s=this._pressedRadio;delete this._pressedRadio,this.delMod(s,"pressed"),this.afterCurrentEvent(function(){if(this.domElem){var e=this.findElem(s,"control");e.prop("checked")||!s.is(t.target)&&!s.find(t.target).length||e.trigger("change").focus()}}),this.unbindFromDoc("pointerrelease")}},{live:function(){return this.liveBindTo("radio","pointerpress",function(t){this._onPointerPress(t)}).liveBindTo("control","focusin focusout",function(t){!this.hasMod("disabled")&&this.toggleMod("focused","yes","focusin"===t.type)}),this.__base()}}),BEM.DOM.decl({block:"radio-button",modName:"breadcrumbs",modVal:"yes"},{_onMouseEvent:function(t){var s=t.type,e=t.data.domElem,i=this.extractElemIndex(e),o=this.elem("radio").length;switch(s){case"mouseover":this.setElemsMod(o,"active","").setElemsMod(o,"checked","").setElemsMod(i,"hovered","yes").setMod(e,"checked","yes").setHint(this.extractHint(e)||this.params.hint);break;case"mouseout":this.selectedIndex||this.setActive(this.selectedIndex),this.setElemsMod(i,"hovered","").setElemsMod(o,"active","").setElemsMod(o,"checked","").setElemsMod(this.selectedIndex,"active","yes").setMod(this.selectedElem,"checked","yes").setHint(this.selectedElem&&this.extractHint(this.selectedElem)||this.params.hint);break;case"click":this.selectedIndex=i,this.selectedElem=e,this.setActive(i).setElemsMod(i,"hovered","").setMod(e,"checked","yes").setHint(this.extractHint(e)||this.params.hint),this.trigger("clicked",i)}},onElemSetMod:{radio:{checked:{yes:function(){this.delMod(this.elem("radio","checked","yes"),"checked")}}}},extractElemIndex:function(t){return this.elem("radio").index(t)+1},setElemsMod:function(t,s,e){return t&&this.setMod(this.elem("radio").slice(0,t),s,e),this},setActive:function(t){return this.setElemsMod(t,"active","yes")},setHint:function(t){return this.elem("hint").text(t||""),this},extractHint:function(t){return this.elemParams(t).hint}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("radio","click mouseover mouseout",function(t){this._onMouseEvent(t)})}}));